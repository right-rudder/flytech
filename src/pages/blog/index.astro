---
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import HeaderSmall from "../../components/HeaderSmall.astro";
import CTAVideoWhite from "../../components/CTAVideoWhite.astro";
import CTAColor from "../../components/CTAColor.astro";
import { getCurrentVideo } from "../../scripts/videoSpinner.js";
import videoList from "../../data/videos.js";
import flyWithUsCTA from "../../data/fly-with-us-cta";
import ImageComp from "../../components/ImageComp.astro";

const data = {
  header: {
    imagePath: "/src/assets/kristopher-allison-KU4zYj4u0mo-unsplash.webp",
    imageAlt: "FlyTech Pilot Academy Fly Over Sunset",
    headerH1: `Our <strong class="text-primary-600">Blog </strong>`,
    paragraph:
      "Get the latest insights and tips from FlyTech Pilot Academy. Stay up-to-date with the latest happenings in the world of flight training.",
    buttons: [
      {
        name: "Read our articles",
        link: "#blogfeed",
        primary: true,
      },
    ],
  },
  cta: {
    imagePath: "/src/assets/PPL-980x653.webp",
    imageAlt: "FlyTech team on the runway preparing a discovery flight",
    headerH1: `<span class="text-primary-600">Start Your Aviation Journey</br></span> Enroll now`,
    paragraph:
      "Experience the thrill of flying and see if the skies are calling you.",
    buttons: [
      {
        name: "Enroll Today",
        link: "/#",
        primary: true,
      },
    ],
  },
};

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const currentVideo = getCurrentVideo(videoList, "discovery flight");
---

<BaseLayout
  siteTitle="Blog | FlyTech Pilot Academy"
  siteDescription="Get the latest insights and tips from FlyTech Pilot Academy. Stay up-to-date with the latest happenings in the world of flight training."
  keywords="blog, flight training blog, aviation blog, pilot training blog, flight school blog, latest tips for pilots, latest insights for pilots"
>
  <!-- Header -->
  <HeaderSmall content={data.header} />

  <CTAVideoWhite video={currentVideo} data={flyWithUsCTA} />

  <section
    class="relative isolate overflow-hidden bg-gradient-to-b from-neutral-900 to-neutral-800 py-24 sm:py-32"
    id="blogfeed"
  >
    <div class="absolute inset-0 -z-10 overflow-hidden">
      <svg
        class="absolute left-[max(50%,25rem)] top-0 h-[64rem] w-[128rem] -translate-x-1/2 stroke-neutral-950 [mask-image:radial-gradient(64rem_64rem_at_top,white,transparent)]"
        aria-hidden="true"
      >
        <defs>
          <pattern
            id="e813992c-7d03-4cc4-a2bd-151760b470a0"
            width="200"
            height="200"
            x="50%"
            y="-1"
            patternUnits="userSpaceOnUse"
          >
            <path d="M100 200V.5M.5 .5H200" fill="none"></path>
          </pattern>
        </defs>
        <svg x="50%" y="-1" class="overflow-visible fill-primary-700">
          <path
            d="M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M-300.5 600h201v201h-201Z"
            stroke-width="0"></path>
        </svg>
        <rect
          width="100%"
          height="100%"
          stroke-width="0"
          fill="url(#e813992c-7d03-4cc4-a2bd-151760b470a0)"></rect>
      </svg>
    </div>
    <div class="mx-auto px-6 lg:px-8">
      <div
        class="mx-auto max-w-7xl px-6 lg:px-8 flex flex-col lg:flex-row items-center gap-12"
      >
        <div class="w-1/2 max-w-2xl text-center lg:text-right">
          <p>
            <span
              class="text-lg font-bold text-primary-500 uppercase tracking-wide mb-4 text-center lg:text-right"
              >Blog</span
            >
          </p>
          <h2
            class="text-3xl lg:text-5xl font-bold text-white mb-4 text-center lg:text-right"
          >
            FlyTech Pilot Academy Articles
          </h2>
          <p class="text-lg text-muted-200 mb-6 text-center lg:text-right">
            News, insights, and tips from FlyTech Pilot Academy. Valuable
            information for aspiring pilots and aviation enthusiasts.
          </p>
          <p class="text-xs text-gray-400">
            {posts.length}{posts.length > 1 ? " Articles" : " Article"}. Since{
              " "
            }
            <FormattedDate date={posts[posts.length - 1].data.pubDate} />
          </p>
        </div>
        <div>
          {
            posts.length && (
              <article class="relative group lg:m-0 w-full isolate flex flex-col justify-end overflow-hidden  bg-white px-8 pb-8 pt-48 lg:pt-80 lg:px-40 hover:ring-1 hover:ring-primary-500 duration-200">
                <div class="h-full w-full absolute inset-0 -z-10">
                  <ImageComp
                    imagePath={posts[0].data.heroImage}
                    imageAlt={posts[0].data.title}
                    class="absolute inset-0 -z-10 h-full w-full object-cover group-hover:scale-110 group-hover:brightness-125 duration-200"
                  />
                </div>

                <div class="absolute inset-0 -z-10 bg-gradient-to-t from-slate-950 via-slate-900/20 group-hover:bg-primary-600/60 duration-200" />
                <div class="absolute inset-0 -z-10 ring-1 ring-inset ring-primary-400/10" />

                <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-100">
                  <time datetime="2020-03-16" class="mr-8 text-primary-600">
                    <FormattedDate date={posts[0].data.pubDate} />
                  </time>
                  <div class="-ml-4 flex items-center gap-x-4">
                    <svg
                      viewBox="0 0 2 2"
                      class="-ml-0.5 h-0.5 w-0.5 flex-none fill-white/50"
                    >
                      <circle cx="1" cy="1" r="1" />
                    </svg>
                    <div class="flex font-bold text-base text-primary-200">
                      {posts[0].data.author}
                    </div>
                  </div>
                </div>
                <h3 class="mt-3 text-lg font-title font-black leading-6 text-primary-100">
                  <a href={`/blog/${posts[0].slug}/`}>
                    <span class="absolute inset-0" />
                    {posts[0].data.title}
                  </a>
                </h3>
              </article>
            )
          }
        </div>
      </div>
      <div
        class="w-full flex flex-wrap gap-3 lg:gap-6 mt-16 mx-auto justify-center"
      >
        {
          posts.slice(1, posts.length).map((post, index) => (
            <article class="relative group w-full lg:m-0 md:w-2/5 lg:w-1/4 isolate flex flex-col justify-end overflow-hidden  bg-white px-8 pb-8 pt-48 lg:pt-80 hover:ring-1 hover:ring-primary-500 duration-200">
              <div class="h-full w-full absolute inset-0 -z-10">
                <ImageComp
                  imagePath={post.data.heroImage}
                  imageAlt={post.data.title}
                  class="absolute inset-0 -z-10 h-full w-full object-cover group-hover:scale-110 group-hover:brightness-125 duration-200"
                />
              </div>
              <div class="absolute inset-0 -z-10 bg-gradient-to-t from-slate-950 via-slate-900/20 group-hover:bg-primary-600/60 duration-200" />
              <div class="absolute inset-0 -z-10 ring-1 ring-inset ring-primary-400/10" />

              <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-100">
                <time datetime="2020-03-16" class="mr-8 text-primary-600">
                  <FormattedDate date={post.data.pubDate} />
                </time>
                <div class="-ml-4 flex items-center gap-x-4">
                  <svg
                    viewBox="0 0 2 2"
                    class="-ml-0.5 h-0.5 w-0.5 flex-none fill-white/50"
                  >
                    <circle cx="1" cy="1" r="1" />
                  </svg>
                  <div class="flex font-bold text-base text-primary-200">
                    {post.data.author}
                  </div>
                </div>
              </div>
              <h3 class="mt-3 text-lg font-title font-black leading-6 text-primary-100">
                <a href={`/blog/${post.slug}/`}>
                  <span class="absolute inset-0" />
                  {post.data.title}
                </a>
              </h3>
            </article>
          ))
        }
      </div>
    </div>
  </section>
  <CTAColor content={data.cta} />
</BaseLayout>
